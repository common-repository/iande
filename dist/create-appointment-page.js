"use strict";(self.webpackChunkiande_plugin=self.webpackChunkiande_plugin||[]).push([[657],{3498:(t,e,n)=>{n.d(e,{Z:()=>u});var r;var i=/^[~!&]*/,a=/\W+/,s={"!":"capture","~":"once","&":"passive"};function o(t){var e=t.match(i)[0];return(null==r?r=/msie|trident/.test(window.navigator.userAgent.toLowerCase()):r)?e.indexOf("!")>-1:e.split("").reduce((function(t,e){return t[s[e]]=!0,t}),{})}const c={name:"Modal",components:{GlobalEvents:{name:"GlobalEvents",props:{target:{type:String,default:"document"},filter:{type:Function,default:function(t){return!0}}},data:function(){return{isActive:!0}},activated:function(){this.isActive=!0},deactivated:function(){this.isActive=!1},render:function(t){return t()},mounted:function(){var t=this;this._listeners=Object.create(null),Object.keys(this.$listeners).forEach((function(e){var n=t.$listeners[e],r=function(r){t.isActive&&t.filter(r,n,e)&&n(r)};window[t.target].addEventListener(e.replace(a,""),r,o(e)),t._listeners[e]=r}))},beforeDestroy:function(){var t=this;for(var e in t._listeners)window[t.target].removeEventListener(e.replace(a,""),t._listeners[e],o(e))}}},props:{label:{type:String,required:!0},narrow:{type:Boolean,default:!1}},data:function(){return{isOpen:!1}},methods:{close:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isOpen=!1,t&&this.$emit("close")},open:function(){var t=this;this.isOpen=!0,this.$nextTick((function(){t.$refs.button.focus()}))}}};const u=(0,n(1900).Z)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isOpen?n("div",{staticClass:"iande-modal__wrapper"},[n("GlobalEvents",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.close.apply(null,arguments)}}}),t._v(" "),n("div",{staticClass:"iande-modal",class:{narrow:t.narrow},attrs:{role:"dialog","aria-modal":"true","aria-label":t.label,tabindex:"-1"}},[n("div",{staticClass:"iande-modal__header"},[n("div",{ref:"button",staticClass:"iande-modal__close",attrs:{role:"button",tabindex:"0","aria-label":t.__("Fechar","iande")},on:{click:t.close,keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.close.apply(null,arguments)}}},[n("Icon",{attrs:{icon:"xmark"}})],1)]),t._v(" "),n("div",{staticClass:"iande-modal__body"},[t._t("default")],2)])],1):n("div")}),[],!1,null,null,null).exports},7141:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var r=n(7757),i=n.n(r),a=n(7033);const s={name:"AppointmentSuccessModal",components:{Modal:n(3498).Z},methods:{close:function(){this.$refs.modal.isOpen&&this.$refs.modal.close(),window.location.assign(this.$iandeUrl("appointment/list"))},open:function(){this.$refs.modal.open()}}};var o=n(1900);const c=(0,o.Z)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{ref:"modal",attrs:{label:t.__("Sucesso!","iande"),narrow:""},on:{close:t.close}},[n("div",{staticClass:"iande-stack"},[n("h1",[t._v(t._s(t.__("Solicitação enviada com sucesso!","iande")))]),t._v(" "),n("p",[t._v(t._s(t.__("A solicitação para seu agendamento foi enviada para o museu. Assim que a sua visita for confirmada, você receberá um email com todos os detalhes.","iande")))]),t._v(" "),n("button",{staticClass:"iande-button solid",on:{click:t.close}},[t._v("\n            "+t._s(t.__("Voltar aos agendamentos","iande"))+"\n        ")])])])}),[],!1,null,null,null).exports;const u={name:"Progress",props:{max:{type:Number,required:!0},min:{type:Number,default:0},title:{type:String,required:!0},value:{type:Number,required:!0}},computed:{percentage:function(){return"".concat(100*(this.value-this.min)/(this.max-this.min),"%")}}};const p=(0,o.Z)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"iande-progress",attrs:{"aria-valuemax":t.max,"aria-valuemin":t.min,"aria-valuenow":t.value,role:"progressbar",title:t.title}},t._l(t.max-t.min,(function(e){return n("div",{key:e,class:{active:e<=t.value-t.min}})})),0)}),[],!1,null,null,null).exports;var l=n(1870);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){v(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t,e,n,r,i,a,s){try{var o=t[a](s),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(r,i)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function s(t){m(a,r,i,s,o,"next",t)}function o(t){m(a,r,i,s,o,"throw",t)}s(void 0)}))}}var _={1:{component:function(){return n.e(736).then(n.bind(n,1922))},action:"saveAppointment",next:2},2:{component:function(){return n.e(689).then(n.bind(n,2768))},action:"saveAppointment",previous:1,next:3,validatePrevious:!0},3:{component:function(){return n.e(267).then(n.bind(n,3065))},action:"saveAppointment",previous:2,next:4,validatePrevious:!0},4:{component:function(){return n.e(938).then(n.bind(n,8462))},action:"saveAppointment",previous:3,next:6,validatePrevious:!0},5:{component:function(){return n.e(264).then(n.bind(n,3821))},action:"saveInstitution",previous:4,next:4,validatePrevious:!1},6:{component:function(){return n.e(296).then(n.bind(n,1929))},action:"confirmAppointment",previous:4,validatePrevious:!0}};const b={name:"CreateAppointmentPage",components:{AppointmentSuccessModal:c,Progress:p},data:function(){return{formError:"",screen:1}},computed:{appointment:(0,a.Z_)("appointments/current"),appointmentId:(0,a.Z_)("appointments/current@ID"),appointmentInstitution:(0,a.Z_)("appointments/current@institution_id"),fields:(0,a.U2)("appointments/filteredFields"),institution:(0,a.Z_)("institutions/current"),institutions:(0,a.Z_)("institutions/list"),page:function(){return this.screen<5?this.screen:this.screen-1},route:function(){return _[this.screen]}},beforeMount:function(){var t=this;return h(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.qs.has("screen")&&(t.screen=Number(l.qs.get("screen"))),!l.qs.has("ID")){e.next=12;break}return e.prev=2,e.next=5,l.hi.get("appointment/get",{ID:Number(l.qs.get("ID"))});case 5:n=e.sent,t.appointment=f(f({},t.appointment),n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),t.formError=e.t0;case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))()},methods:{confirmAppointment:function(){var t=this;return h(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.saveAppointment();case 3:if(!e.sent){e.next=9;break}return e.next=6,t.finishAppointment();case 6:return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),t.formError=e.t0,e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},finishAppointment:function(){var t=this;return h(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.hi.post("appointment/set_status",{ID:t.appointment.ID,post_status:"pending"});case 2:t.$refs.modal.open();case 3:case"end":return e.stop()}}),e)})))()},isFormValid:function(){var t=this.$refs.form;return t.$v.$touch(),!t.$v.$invalid},nextStep:function(){var t=this;return h(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.formError="",!t.isFormValid()){e.next=6;break}return e.next=4,t[t.route.action]();case 4:e.sent&&t.route.next&&t.setScreen(t.route.next);case 6:case"end":return e.stop()}}),e)})))()},previousStep:function(){this.formError="",this.route.validatePrevious&&!this.isFormValid()||this.setScreen(this.route.previous)},resetAppointment:(0,a.RE)("appointments/reset"),resetInstitution:(0,a.RE)("institutions/reset"),saveAppointment:function(){var t=this;return h(i().mark((function e(){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.fields.ID?"update":"create",e.next=4,l.hi.post("appointment/".concat(n),t.fields);case 4:return r=e.sent,t.appointment=f(f({},t.appointment),r),t.appointmentId=r.ID,e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),t.formError=e.t0,e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))()},saveInstitution:function(){var t=this;return h(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.hi.post("institution/create",t.institution);case 3:return n=e.sent,t.appointmentInstitution=n.ID,e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),t.formError=e.t0,e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},setScreen:function(t){this.screen=t}}};const g=(0,o.Z)(b,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("article",{staticClass:"mt-lg"},[n("div",{staticClass:"iande-container narrow mt-lg"},[n("Progress",{attrs:{title:t.sprintf(t.__("Página %s de %s","iande"),t.page,5),value:t.page,max:5}})],1),t._v(" "),n("div",{staticClass:"iande-container narrow iande-stack stack-lg mt-lg"},[n("form",{staticClass:"iande-form iande-stack stack-lg",on:{submit:function(e){return e.preventDefault(),t.nextStep.apply(null,arguments)}}},[n(t.route.component,{ref:"form",tag:"component",on:{"add-institution":function(e){return t.setScreen(5)}}}),t._v(" "),t.formError?n("div",{staticClass:"iande-form-error"},[n("span",[t._v(t._s(t.__(t.formError,"iande")))])]):t._e(),t._v(" "),n("div",{staticClass:"iande-form-grid"},[t.route.previous?n("button",{staticClass:"iande-button solid",attrs:{type:"button"},on:{click:t.previousStep}},[n("Icon",{attrs:{icon:"angle-left"}}),t._v("\n                    "+t._s(t.__("Voltar","iande"))+"\n                ")],1):n("div"),t._v(" "),n("button",{staticClass:"iande-button primary",attrs:{type:"submit"}},[t._v("\n                    "+t._s(t.__("Avançar","iande"))+"\n                    "),n("Icon",{attrs:{icon:"angle-right"}})],1)])],1)]),t._v(" "),n("AppointmentSuccessModal",{ref:"modal"})],1)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=create-appointment-page.js.map