"use strict";(self.webpackChunkiande_plugin=self.webpackChunkiande_plugin||[]).push([[702],{9111:(t,e,n)=>{n.r(e),n.d(e,{default:()=>d});var a=n(7757),o=n.n(a),r=n(1870);function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var a,o,r=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!e||r.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function l(t,e,n,a,o,r,i){try{var c=t[r](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(a,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var r=t.apply(e,n);function i(t){l(r,a,o,i,c,"next",t)}function c(t){l(r,a,o,i,c,"throw",t)}i(void 0)}))}}var u=window.IandeSettings.tainacanUrl,m="metaquery[0][key]=metadata_type&metaquery[0][value]=Tainacan%5CMetadata_Types%5CTaxonomy";const f={name:"ItineraryMetabox",props:{previous:{type:Object,required:!0}},data:function(){return{collections:[],facetsCache:{},fetched:!1,form:{collection:null,metakey:null,metavalue:null},globalMetadata:[],metadataCache:{}}},computed:{metadata:function(){var t;return this.form.collection?null!==(t=this.metadataCache[this.form.collection])&&void 0!==t?t:[]:this.globalMetadata},terms:function(){var t;return this.form.metakey&&null!==(t=this.facetsCache[this.form.metakey])&&void 0!==t?t:[]}},watch:{"form.collection":function(){this.form.collection&&!this.metadataCache[this.form.collection]&&this.fetchMetadata(this.form)},"form.metakey":function(){this.form.metakey&&!this.facetsCache[this.form.metakey]&&this.fetchFacets(this.form)},metadata:function(){var t=this;this.fetched&&!this.metadata.find((function(e){return e.id===t.form.metakey}))&&(this.form.metakey=null,this.form.metavalue=null)},terms:function(){this.fetched&&(this.form.metavalue=null)}},created:function(){var t=this;return s(o().mark((function e(){var n,a,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([r.hi.get("".concat(u,"/collections")),r.hi.get("".concat(u,"/metadata?").concat(m))]);case 3:if(n=e.sent,a=i(n,2),c=a[0],l=a[1],t.collections=c,t.globalMetadata=l,!t.previous){e.next=13;break}return e.next=12,Promise.all([t.previous.collection?t.fetchMetadata(t.previous):null,t.previous.metakey?t.fetchFacets(t.previous):null]);case 12:t.form=t.previous;case 13:t.$nextTick((function(){t.fetched=!0})),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))()},methods:{fetchFacets:function(t){var e=this;return s(o().mark((function n(){var a,i,c,l;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.collection,i=t.metakey,n.prev=1,c=a?"collection/".concat(a,"/facets/").concat(i):"facets/".concat(i),n.next=5,r.hi.get("".concat(u,"/").concat(c,"?hideempty=0"));case 5:l=n.sent,e.$set(e.facetsCache,i,l.values),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.error(n.t0);case 12:case"end":return n.stop()}}),n,null,[[1,9]])})))()},fetchMetadata:function(t){var e=this;return s(o().mark((function n(){var a,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.collection,n.prev=1,n.next=4,r.hi.get("".concat(u,"/collection/").concat(a,"/metadata?").concat(m));case 4:i=n.sent,e.$set(e.metadataCache,a,i),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),console.error(n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])})))()}}};const d=(0,n(1900).Z)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"iande-itinerary-metabox"},[n("div",{staticClass:"components-base-control__field"},[n("label",{staticClass:"components-input-control__label",attrs:{for:"tainacan-collection"}},[t._v(t._s(t.__("Coleção","iande")))]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.form.collection,expression:"form.collection"}],staticClass:"components-select-control__input",attrs:{name:"tainacan-collection",id:"tainacan-collection"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"collection",e.target.multiple?n:n[0])}}},[n("option",{key:0,domProps:{value:null}},[t._v(t._s(t.__("Todo o repositório","iande")))]),t._v(" "),t._l(t.collections,(function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],2)]),t._v(" "),n("div",{staticClass:"components-base-control__field"},[n("label",{staticClass:"components-input-control__label",attrs:{for:"tainacan-metakey"}},[t._v(t._s(t.__("Filtro","iande")))]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.form.metakey,expression:"form.metakey"}],staticClass:"components-select-control__input",attrs:{name:"tainacan-metakey",id:"tainacan-metakey"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"metakey",e.target.multiple?n:n[0])}}},[n("option",{key:0,domProps:{value:null}},[t._v(t._s(t.__("Sem filtro","iande")))]),t._v(" "),t._l(t.metadata,(function(e){return n("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(t.__(e.name,"iande")))])}))],2)]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.form.metakey,expression:"form.metakey"}],staticClass:"components-base-control__field"},[n("label",{staticClass:"components-input-control__label",attrs:{for:"tainacan-metavalue"}},[t._v(t._s(t.__("Valor","iande")))]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.form.metavalue,expression:"form.metavalue"}],staticClass:"components-select-control__input",attrs:{name:"tainacan-metavalue",id:"tainacan-metavalue"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"metavalue",e.target.multiple?n:n[0])}}},t._l(t.terms,(function(e){return n("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.label)+" ("+t._s(e.total_items)+")")])})),0)]),t._v(" "),n("input",{attrs:{type:"hidden",id:"tainacan-meta",name:"tainacan-meta"},domProps:{value:JSON.stringify(t.form)}})])}),[],!1,null,null,null).exports},1900:(t,e,n)=>{function a(t,e,n,a,o,r,i,c){var l,s="function"==typeof t?t.options:t;if(e&&(s.render=e,s.staticRenderFns=n,s._compiled=!0),a&&(s.functional=!0),r&&(s._scopeId="data-v-"+r),i?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},s._ssrRegister=l):o&&(l=c?function(){o.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(s.functional){s._injectStyles=l;var u=s.render;s.render=function(t,e){return l.call(e),u(t,e)}}else{var m=s.beforeCreate;s.beforeCreate=m?[].concat(m,l):[l]}return{exports:t,options:s}}n.d(e,{Z:()=>a})}}]);
//# sourceMappingURL=itinerary-metabox.js.map